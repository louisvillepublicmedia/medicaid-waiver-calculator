<!doctype html>
<html lang='en-GB'>
<head>
	<link rel="stylesheet" href="../css/skeleton.css">	
	<link rel="stylesheet" href="css/style.css">

  <meta charset='utf-8'>
  <title>Medicaid Waiver Calculator</title>
</head>

  <body>
  	
  	<!-- All of the html element represented in the <script id='template'> below will render to this container -->
    <div id='container' class='container'></div>
  
    <script id='template' type='text/ractive'>
    	<div class="row">
  		  <h1>Medicaid Waiver Calculator</h1>
  		  <p class="lead">WFPL created this calculator to help you understand how the Medicaid waiver will affect you based on your personal situation.</p>
        <p class="lead">To use the calculator, go through each step to select your personal characteristics. Use the sliders to set your household income and property value; you'll see the dollar figures adjust in the box to the right. Then check any of the additional boxes for circumstances that might apply to you.</p>
        <p class="lead">Please note that this app does not collect or store your personal information.</p>
  		</div>
  		
  		<div id="app-begin" class="row thick-divider">&nbsp</div>
  		
  		<div class="row">
  		  <div class="one-half column">
  		  	<!--user inputs-->
  			  <form>
    			  
    			  <div class="form-group">
  			  		<div class="form-head">
  			  			<h4>Factors that will exclude you from having to comply with these measures in order to receive Medicaid:</h4>
  			  		</div>
  			  		<div class="row">
    			  		<strong>Do any of these waivers apply to you?</strong>
    			  		<select value='{{selectedMedWaiver}}'>
                  <option selected> No</option>
                  {{#waivers}}
                      <option value='{{id}}'>{{name}}</option>
                  {{/waivers}}
                </select>
                
                <br>
                
                <strong>Do any of these medical conditions apply to you?</strong>
    			  		<select value='{{selectedMedCondition}}'>
                  <option selected> No</option>
                  {{#waivers}}
                      <option value='{{id}}'>{{name}}</option>
                  {{/waivers}}
                </select>
  				  		
  				  		<br>
  				  		
  							<strong>Do any of these additional factors apply to you?</strong>
  							<label>
  						    <input type='checkbox' checked='{{med_waiver_2}}'>
  						    I meet Social Security disability criteria 
  							</label>
  							<label>
  						    <input type='checkbox' checked='{{former_foster}}'>
  						    I am a former foster care youth and am currently under 26 years of age
  							</label>
  							<label>
  						    <input type='checkbox' checked='{{pregnant}}'>
  						    I am currently pregnant
  							</label>
  						
  				  		<label>
  						    <input type='checkbox' checked='{{medicare}}'>
  						    I currently receive Medicare
  							</label>
  							<label>
  						    <input type='checkbox' checked='{{student}}'>
  						    I am a full-time student
  							</label>
              </div>
            </div>
  			  	
  			  	<div class="form-group" id="householdSlider">
  			  		<div class="form-head">
  				  		<h4>Select your household size:</h4>
  				  		<label>Include yourself, your spouse (if married) and anyone you'll claim as a tax dependent in 2019</label>
  				  	</div>
  			  		<input type="range" min="0" max="20" step="1" value="{{userHousehold}}" />
  			  		<label class="indicator">Household size = {{userHousehold}}</label>
  			  	</div>
  			  	
  			  	{{#if userHousehold > 1}}
  			  	  <div class="form-group" id="dependentSlider">
  			  		<div class="form-head">
  				  		<h4>How many dependents do you claim:</h4>
  				  		<label>Include anyone you'll claim as a tax dependent in 2019</label>
  				  	</div>
  			  		<input type="range" min="0" max="20" step="1" value="{{userDependents}}" />
  			  		{{#if userDependents + 1 > userHousehold}}
  			  		  <label class="error indicator">You can't have more dependents than you have household members.</label>
              {{else}}
                <label class="indicator">Dependents = {{userDependents}}</label>
              {{/if}}
  			  	</div>
  			  	{{/if}}
  			  	
  			  	<div class="form-group" id="incomeSlider">
  			  		<div class="form-head">
  				  		<h4>Select household income:</h4>
  				  		<label>Use your <a href="https://turbotax.intuit.com/tax-tips/irs-tax-return/what-is-the-difference-between-agi-and-magi-on-your-taxes/L7kHckNS3" target="_blank">modified adjusted gross income here</a>.</label>
  				  		{{#if incomeAlert}}
  				  		  <label class="alert">{{incomeAlert}}</label>
  				  		{{/if}}
  				  	</div>
  			  		<input type="range" min="0" max="65000" step="50" value="{{userIncome}}" />
  			  		<label class="indicator">Household income = {{dollarFormat(userInput.income)}}</label>
  			  	</div>
  			  	  					
  			  </form>
  		  </div>
  		  
  		  <div class="one-half column results">
  				<p><strong>Your age:</strong> {{userInput.age}}</p>
  				<p><strong>Household size:</strong> {{userInput.household}}</p>
  				<p><strong># of dependents:</strong> {{userInput.dependents}}</p>
  				<p><strong>Household income:</strong> {{dollarFormat(userInput.income)}}</p>
  				<p>
    				<strong>Poverty status:</strong>
    				{{ userInput.povertyHR }}
  				</p>
  				
  				<div class="row thick-divider">&nbsp</div>
  				
  				<h4>New measures</h4>
  				<ul>
  				{{ #each applicableMeasures: num }}
  				  <li>{{applicableMeasures[num]}}</li>
  				{{/each}}
  				</ul>
  				
  		  </div>
  		  
  		</div>
  		
  	  <div class="row thick-divider">&nbsp</div>
      
      <div class="row">
    		<h3>About the Data </h3>		
  		  <p class="credit">Sources: xxxxxx<br>
  		  Calculator developed by Alexandra Kanik</p>
  	  </div>
  	  
    </script>
  
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'></script>
    <script src='../../js/ractive.js'></script>
  
  
    <script>
    	$(document).ready(function() {
      	
      	$(window).scroll(function(){
          var currentScreenPosition  = $(document).scrollTop();
          var appScreenPosition = $('#app-begin').offset().top;
          if (currentScreenPosition > appScreenPosition) {
            $( '.results' ).addClass( 'fixed' );
          }else{
            $( '.results' ).removeClass( 'fixed' );
          };
        });
    		
    		var waiver_measures = {
      		'nemt':'Access Non-Emergency Medical Transportation',
      		'retro':'Retroactive eligibility',
          'noretro':'No retroactive eligibility',
          'noco':'No copays or premiums',
          'choiceco':'Choice to pay copays instead of premiums',
          'sixtydays':'60 days to make premium payment',
          'immediate':'Premium payment due before coverage can start',
          'noengage':'No community engagment',
          'engage':'Community engagment required',
          'autoenroll':'Auto-enrolled in Medicaid',
          'benefits':'Keep vision and other benefits',
          'myrewards':'Can earn points toward MyRewards program',
          'myrewardsgym':'Can earn points toward MyRewards program for gym benefits, if they pay a premium',
          'report':'Manditory reporting for changes to Medicaid eligibility'
          };
          
        var med_waivers = [
          {id:'HC', name:'Home and Community-Based Waiver - 1915(c)'},
          {id:'MP', name:'Michelle P Waiver - 1915(c)'},
          {id:'ABI', name:'Acquired Brain Injury - 1915(c)'},
          {id:'ABILT', name:'Acquired Brain Injury, Long Term Care - 1915(c)'},
          {id:'M', name:'Model Waiver II - 1915(c)'},
          {id:'SCL', name:'Supports for Community Living - 1915(c)'},
          {id:'NF', name:'Nursing Facility and ICF/MR Residents'},
          {id:'QMB', name:'Qualified Medicare Beneficiaries'}
        ];
        
        var med_conditions = [
          {id:'MD', name:'Disabling mental disorder'},
          {id:'SUD', name:'Chronic Substance Use Disorder'},
          {id:'SCMC', name:'Serious and complex medical conditions'},
          {id:'IDD', name:'Physical, intellectual or developmental disabilities'}
        ];
          
        var applicable_measures = [];          
        var general_list = [];
        var cat2_list = [];
        var cat3_list = [];
        var cat4_list = [];
        var filtered_list = [];
                
    		
  	    var ractive = new Ractive({
  	      el: 'container',	
  	      template: '#template',
  	      data: {
  	      	userInput: {
    	      	income: 12000,
    	      	age: 18,
    	      	household: 1,
    	      	dependents:0,
    	      	pregnant: 0,
    	      	former_foster: 0,
    	      	med_frail: 0,
    	      	caregiver: 0,
    	      	student: 0
  	      	},
  	      	userIncome: 12000,
  	      	userAge:18,
  	      	userHousehold:1,
  	      	userDependents:0,
  	      	applicableMeasures:waiver_measures,
  	      	waivers:med_waivers,
  	      	conditions:med_conditions,
  					
  					//formats
  					dollarFormat: function(num){
  						var deciNum = parseFloat(Math.round(num*100)/100).toFixed(0);
  						var milNum = deciNum.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")
  						return '$' + milNum;
  					}					
  	      }// end data
  	    }); //end var ractive
    		
  	    
  	    // Watch for changes on the School District input. When a change is detected, 
  	    // grab the index of the user's selection so that we can set millage and 
  	    // homestead exemption variables. Also, property tax is dependent on school district, 
  	    // so when the school district changes, run the function that determines property tax.
  	    
  	    /*ractive.observe('userAge', function(newValue, oldValue){
  				ractive.set('userInput.age', newValue);
  				compile_applicable_measures()
  	    });*/
  	    
  	    ractive.observe('userIncome', function(newValue, oldValue){
  				ractive.set('userInput.income', newValue);
  				if(newValue > 60000){
    				var incomeAlert = 'If you make more than $60,000, you would have to have a family size \
    				  of more than 12 to qualify for Medicaid.';
    				ractive.set('incomeAlert', incomeAlert)
  				};
  				setPovertyStatus();
  				compile_applicable_measures()
  	    });
  	    
  	    ractive.observe('selectedMedWaiver', function(newValue, oldValue){
    	    console.log(newValue);
  				ractive.set('userInput.med_waiver', 1);
  				compile_applicable_measures()
  	    });
  	    
  	    ractive.observe('userHousehold', function(newValue, oldValue){
  				ractive.set('userInput.household', newValue);
  				setPovertyStatus();
  				compile_applicable_measures()
  	    });
  	    
  	    ractive.observe('userDependents', function(newValue, oldValue){
  				ractive.set('userInput.dependents', newValue);
  				compile_applicable_measures()
  	    });
  	    
  	    ractive.observe('pregant', function(newValue, oldValue){
  				ractive.set('userInput.pregnant', newValue);
  				compile_applicable_measures()
  	    });
  	    
  	    ractive.observe('med_frail', function(newValue, oldValue){
  				ractive.set('userInput.med_frail', newValue);
  				compile_applicable_measures();
  	    });
  	    
  	    ractive.observe('former_foster', function(newValue, oldValue){
  				ractive.set('userInput.former_foster', newValue);
  				compile_applicable_measures();
  	    });
  	    
  	    ractive.observe('caregiver', function(newValue, oldValue){
  				ractive.set('userInput.caregiver', newValue);
  				compile_applicable_measures();
  	    });
  	    
  	    ractive.observe('student', function(newValue, oldValue){
  				ractive.set('userInput.student', newValue);
  				compile_applicable_measures();
  	    });
  	      	    
  	    function getPovertyLevel(household){
    	    if(household == 1) return 12140;
    	    if(household == 2) return 16460;
    	    if(household == 3) return 20780;
    	    if(household == 4) return 25100;
    	    if(household == 5) return 29420;
    	    if(household == 6) return 33740;
    	    if(household == 7) return 38060;
    	    if(household == 8) return 42380;
    	    if(household == 9) return 46700;
    	    if(household == 10) return 51020;
    	    if(household == 11) return 55340;
    	    if(household == 12) return 59660;
  	    }
  	    
  	    function setPovertyStatus(){
    	    var income = ractive.get('userInput.income');
    	    var household = ractive.get('userInput.household');
    	    var povertyLevel = getPovertyLevel(household);
    	    var poverty138Level = povertyLevel*1.38;
    	    var poverty54Level = povertyLevel*.54;
    	    
    	    if(income <= poverty54Level){
      	    ractive.set('userInput.povertyHR','Your income is at or below 54% of the poverty level.');
      	    ractive.set('userInput.poverty54', 1);
      	    ractive.set('userInput.poverty138', 1);
      	    ractive.set('userInput.poverty', 1);
    	    }else if(income <= povertyLevel && income > poverty54Level){
      	    ractive.set('userInput.povertyHR','Your income is at or below 100% of the poverty level.');
      	    ractive.set('userInput.poverty54', 0);
      	    ractive.set('userInput.poverty138', 1);
      	    ractive.set('userInput.poverty', 1);
          }else if(income > povertyLevel && income <= poverty138Level){
            ractive.set('userInput.povertyHR','Your income is at or below 138% of the poverty level.')
            ractive.set('userInput.poverty54', 0);
            ractive.set('userInput.poverty138', 1);
      	    ractive.set('userInput.poverty', 0);
          }else{
            ractive.set('userInput.povertyHR','Your income does not meet income requirements for Medicaid.')
            ractive.set('userInput.poverty54', 0);
            ractive.set('userInput.poverty138', 0);
      	    ractive.set('userInput.poverty', 0);
          }
    	  }
    	  
    	  function filter_measures(applicable_measures, general_list, cat2_list, cat3_list, cat4_list){
          //for some category lists, values conflict
          //this is where we set the priority for those values
          
          filtered_list = [];
          
          if(cat2_list.length > 1){
            cat2_list = ['Retroactive eligibility']
          };
          
          if(cat3_list.length > 1 && cat3_list.indexOf('No copays or premiums')>-1){
            cat3_list = ['No copays or premiums']
          }else if(cat3_list.indexOf('Premium payment due before coverage can start')>-1 && cat3_list.indexOf('60 days to make premium payment')>-1){
            indexprepay = cat3_list.indexOf('Premium payment due before coverage can start');
            cat3_list.splice(indexprepay,1);
          };
          
          if(cat4_list.length > 1){
            cat4_list = ['No community engagment']
          };
          
          filtered_list = applicable_measures.concat(general_list, cat2_list, cat3_list, cat4_list);
          unique_filtered_list = filtered_list.reduce(function(a,b){
            if(a.indexOf(b) == -1){
              a.push(b);
            }
            return a;
          }, []);
          
          ractive.set('applicableMeasures', unique_filtered_list);
        };

        
        function compile_applicable_measures(){
          applicable_measures = [];
          
          general_list = [];
          cat2_list = [];
          cat3_list = [];
          cat4_list = [];
                    
          pregnant = ractive.get('userInput.pregnant');
          age = ractive.get('userInput.age');
          former_foster = ractive.get('userInput.former_foster');
          med_frail = ractive.get('userInput.med_frail');
          caregiver = ractive.get('userInput.caregiver');
          student = ractive.get('userInput.student');
          poverty = ractive.get('userInput.poverty');
          poverty138 = ractive.get('userInput.poverty138');
          
          
          if(poverty == 0 &&  poverty138 == 0){
            applicable_measures = ['Your income does not meet income requirements for Medicaid.']
            ractive.set('applicableMeasures', applicable_measures);
          }else if(age > 64){
            applicable_measures = ['You do not have any changes to your Medicaid benefits.']
            ractive.set('applicableMeasures', applicable_measures);
          }else{
            if(poverty == 0 && poverty138 == 1){
              general_list.push(waiver_measures['report']);
              general_list.push(waiver_measures['myrewardsgym']);
              cat2_list.push(waiver_measures['noretro']);
              cat3_list.push(waiver_measures['immediate']);
              cat4_list.push(waiver_measures['engage']);
            }else if(poverty == 1){
              general_list.push(waiver_measures['report']);
              general_list.push(waiver_measures['autoenroll']);
              general_list.push(waiver_measures['benefits']);
              general_list.push(waiver_measures['myrewardsgym']);
              cat2_list.push(waiver_measures['noretro']);
              cat3_list.push(waiver_measures['choiceco']);
              cat3_list.push(waiver_measures['sixtydays']);
              cat4_list.push(waiver_measures['engage'])
            };
            if(former_foster == 1 && age < 27){
              general_list.push(waiver_measures['report']);
              general_list.push(waiver_measures['nemt']);
              general_list.push(waiver_measures['autoenroll']);
              general_list.push(waiver_measures['benefits']);
              general_list.push(waiver_measures['myrewardsgym']);
              cat2_list.push(waiver_measures['retro']);
              cat3_list.push(waiver_measures['noco']);
              cat4_list.push(waiver_measures['noengage']);
            };
            if(pregnant == 1){
              general_list.push(waiver_measures['report']);
              general_list.push(waiver_measures['autoenroll']);
              general_list.push(waiver_measures['benefits']);
              general_list.push(waiver_measures['nemt']);
              cat2_list.push(waiver_measures['retro']);
              cat3_list.push(waiver_measures['noco']);
              cat4_list.push(waiver_measures['noengage']);
            };
            if(med_frail == 1){
              general_list.push(waiver_measures['report']);
              general_list.push(waiver_measures['autoenroll']);
              general_list.push(waiver_measures['benefits']);
              general_list.push(waiver_measures['myrewardsgym']);
              general_list.push(waiver_measures['nemt']);
              cat2_list.push(waiver_measures['noretro']);
              cat3_list.push(waiver_measures['noco']);
              cat4_list.push(waiver_measures['noengage']);
            };
            if(caregiver == 1 || student == 1){
              general_list.push(waiver_measures['myrewards']);
              cat2_list.push(waiver_measures['noretro']);
              cat4_list.push(waiver_measures['noengage']);
            };
            
            filter_measures(applicable_measures, general_list, cat2_list, cat3_list, cat4_list);
          };
        };  	   
  	}); //end $(document).ready
  			
  	</script>
  </body>
</html>
